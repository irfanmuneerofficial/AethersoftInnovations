$((function(){var e=$(".review-list-container"),a=[],t=function(e){e.lightGallery({thumbnail:!0})},n=function(a,n){a&&$.ajax({url:a,method:"GET",beforeSend:function(){e.append('<div class="loading-spinner"></div>')},success:function(a){var r=a.data,i=a.message;e.find("h4").text(i),e.find(".review-list").html(r),void 0!==Theme.lazyLoadInstance&&Theme.lazyLoadInstance.update(),t(e.find(".review-images")),n&&n()},complete:function(){e.find(".loading-spinner").remove()}})},r=function(e){for(var t=new ClipboardEvent("").clipboardData||new DataTransfer,n=0,r=a;n<r.length;n++){var i=r[n];t.items.add(i)}e.files=t.files,function(e){var a=$(".image-upload__text"),t=$(e).data("max-files"),n=e.files.length;t?(n>=t?a.closest(".image-upload__uploader-container").addClass("d-none"):a.closest(".image-upload__uploader-container").removeClass("d-none"),a.text(n+"/"+t)):a.text(n);var r=$(".image-viewer__list"),i=$("#review-image-template").html();if(r.find(".image-viewer__item").remove(),n){for(var o=n-1;o>=0;o--)r.prepend(i.replace("__id__",o));for(var s=function(a){var t=new FileReader;t.onload=function(e){r.find(".image-viewer__item[data-id="+a+"]").find("img").attr("src",e.target.result)},t.readAsDataURL(e.files[a])},l=n-1;l>=0;l--)s(l)}}(e)};e.length&&(t($(".review-images")),n(e.data("ajax-url"))),e.on("click",".pagination a",(function(a){a.preventDefault();var t=$(a.currentTarget).prop("href");n(t,(function(){$("html, body").animate({scrollTop:e.offset().top-130})}))})),$(document).on("submit",".product-review-container form",(function(t){t.preventDefault(),t.stopPropagation();var r=$(t.currentTarget),i=r.find('button[type="submit"]');$.ajax({type:"POST",cache:!1,url:r.prop("action"),data:new FormData(r[0]),contentType:!1,processData:!1,beforeSend:function(){i.prop("disabled",!0).addClass("loading")},success:function(t){var i=t.error,o=t.message;i?Theme.showError(o):(r.find("select").val(0),r.find("textarea").val(""),r.find("input[type=file]").val(""),r.find("input.custom-field").val(""),a=[],Theme.showSuccess(o),n(e.data("ajax-url"),(function(){$(".review-list").length||setTimeout((function(){return window.location.reload()}),1e3)})))},error:function(e){Theme.handleError(e,r)},complete:function(){i.prop("disabled",!1).removeClass("loading")}})})),$(document).on("change",".product-review-container form input[type=file]",(function(e){e.preventDefault();var t=this,n=$(t),i=n.data("max-size");Object.keys(t.files).map((function(e){if(i&&t.files[e].size/1024>i){var r=n.data("max-size-message").replace("__attribute__",t.files[e].name).replace("__max__",i);Theme.showError(r)}else a.push(t.files[e])}));var o=a.length,s=n.data("max-files");s&&o>s&&a.splice(o-s-1,o-s),r(t)})),$(document).on("click",".product-review-container form .image-viewer__icon-remove",(function(e){e.preventDefault();var t=$(e.currentTarget).closest(".image-viewer__item").data("id");a.splice(t,1);var n=$(".product-review-container form input[type=file]")[0];r(n)})),$(document).on("click",".delete-review-btn",(function(a){a.preventDefault();var t=$(this),r=t.data("review-id"),i=t.data("confirm-message");if(confirm(i)){var o="/review/delete/".concat(r);$.ajax({url:o,type:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},beforeSend:function(){t.prop("disabled",!0).addClass("loading")},success:function(a){var t=a.message;Theme.showSuccess(t),n(e.data("ajax-url"),(function(){$(".review-list .review-item").length||setTimeout((function(){return window.location.reload()}),1e3)}))},error:function(e){var a="An error occurred while deleting the review.";e.responseJSON&&e.responseJSON.message&&(a=e.responseJSON.message),Theme.showError(a)},complete:function(){t.prop("disabled",!1).removeClass("loading")}})}})),sessionStorage.reloadReviewsTab&&($('#product-detail-tabs a[href="#product-reviews"]').length&&new bootstrap.Tab($('#product-detail-tabs a[href="#product-reviews"]')[0]).show(),sessionStorage.reloadReviewsTab=!1)}));